{% extends 'base.html' %}

{% block head %}

<title>Drone</title>
<link rel="stylesheet" href="/static/css/drone.css">

{% endblock %}

{% block body %}

<body class="sensor-body">
  <script>
    function updateData(){
      fetch('/data/LH_Farm drone ' + "{{ id }}")
        .then(response => response.json())
        .then(json => {
          if (json) {
            document.getElementById('msg').textContent = json.data.msg;
            document.getElementById('flight_mode').textContent = json.data.flight_mode;
            document.getElementById('arm_state').textContent = json.data.arm_state;
            document.getElementById('on_water').textContent = json.data.on_water;
            document.getElementById('vel').textContent = json.data.vel;
            document.getElementById('alt').textContent = json.data.alt;
            document.getElementById('lat').textContent = json.data.lat;
            document.getElementById('lon').textContent = json.data.lon;
            document.getElementById('hdg').textContent = json.data.hdg;
            document.getElementById('GLOBAL_POSITION_INT').textContent = json.time.GLOBAL_POSITION_INT;
            document.getElementById('voltage').textContent = json.data.voltage;
            document.getElementById('current').textContent = json.data.current;
            document.getElementById('BATTERY_STATUS').textContent = json.time.BATTERY_STATUS;
            document.getElementById('NAMED_VALUE_FLOAT').textContent = json.time.NAMED_VALUE_FLOAT;
            document.getElementById('p_DO').textContent = json.data.p_DO;
            document.getElementById('p_pres').textContent = json.data.p_pres;
            document.getElementById('p_temp').textContent = json.data.p_temp;
            //convert time to min:sec
            let ftime = parseInt(json.data.flight_time);
            let fmins = Math.floor(ftime / 60);
            let fsecs = ftime - fmins * 60;
            document.getElementById('flight_time_mins').textContent = fmins;
            document.getElementById('flight_time_secs').textContent = fsecs;
          }
        })
    }
    updateData()
    setInterval(updateData, 2000);
  </script>

  <h2>{{ id }}</h2>
  <div class="row">
    <div class="column">
      <h2>Flight Information</h2>
      <table class="table">
        <tr>
          <td>mode</td>
          <td><span id="flight_mode"></span></td>
        </tr>
        <tr>
          <td>arm state</td>
          <td><span id="arm_state"></span></td>
        </tr>
        <tr>
          <td>on water</td>
          <td><span id="on_water"></span></td>
        </tr>
        <tr>
          <td>flight time</td>
          <td><span id="flight_time_mins"></span>:<span id="flight_time_secs"></span></td>
        </tr>
      </table>
      <h2>Position Information</h2>
      <table class="table">
        <tr>
          <td>velocity</td>
          <td><span id="vel"></span></td>
        </tr>
        <tr>
          <td>altitude</td>
          <td><span id="alt"></span></td>
        </tr>
        <tr>
          <td>latitude</td>
          <td><span id="lat"></span></td>
        </tr>
        <tr>
          <td>longitude</td>
          <td><span id="lon"></span></td>
        </tr>
        <tr>
          <td>heading</td>
          <td><span id="hdg"></span></td>
        </tr>
        <tr>
          <td>last update</td>
          <td><span id="GLOBAL_POSITION_INT"></span></td>
        </tr>
      </table>
    </div>

    <div class="column">
      <h2>Vehicle Health</h2>
      <table class="table">
        <tr>
          <td>battery voltage</td>
          <td><span id="voltage"></span></td>
        </tr>
        <tr>
          <td>battery current</td>
          <td><span id="current"></span></td>
        </tr>
        <tr>
          <td>last update</td>
          <td><span id="BATTERY_STATUS"></span></td>
        </tr>
      </table>
      <h2>Payload</h2>
      <table class="table">
        <tr>
          <td>DO</td>
          <td><span id="p_DO"></span></td>
        </tr>
        <tr>
          <td>pressure</td>
          <td><span id="p_pres"></span></td>
        </tr>
        <tr>
          <td>temperature</td>
          <td><span id="p_temp"></span></td>
        </tr>
        <tr>
          <td>last update</td>
          <td><span id="NAMED_VALUE_FLOAT"></span></td>
        </tr>
      </table>
      <h2>Messages</h2>
      <span id="msg"></span>
    </div>  
  </div>
</body>

{% endblock %}